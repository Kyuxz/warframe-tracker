<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <title>Warframe Activity Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .header {
            background: #0a0a0a;
            border-bottom: 2px solid #1a1a1a;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .search-bar {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 16px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 0.95rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .refresh-btn, .clear-btn {
            padding: 10px 20px;
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .refresh-btn:hover, .clear-btn:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 15px;
        }

        .card {
            background: #0a0a0a;
            border: 1px solid #1a1a1a;
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #333;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(255, 255, 255, 0.05);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
            padding-bottom: 10px;
            border-bottom: 1px solid #1a1a1a;
        }

        .card-icon {
            font-size: 22px;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
        }

        .content-box {
            background: #000;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #1a1a1a;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .content-box:hover {
            background: #0a0a0a;
            border-color: #333;
        }

        .scrollable {
            max-height: 400px;
            overflow-y: auto;
        }

        .scrollable::-webkit-scrollbar {
            width: 6px;
        }

        .scrollable::-webkit-scrollbar-track {
            background: #000;
        }

        .scrollable::-webkit-scrollbar-thumb {
            background: #333;
            border-radius: 4px;
        }

        .tier-filters {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .tier-btn {
            padding: 6px 12px;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 6px;
            color: #666;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tier-btn:hover {
            background: #333;
        }

        .tier-btn.active {
            background: #fff;
            color: #000;
            border-color: #fff;
        }

        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            margin-right: 5px;
            text-transform: uppercase;
        }

        .badge.lith, .badge.meso, .badge.neo, .badge.axi, .badge.requiem, .badge.omnia {
            background: #666;
            color: #000;
        }

        .badge.storm { background: #4a90e2; }

        .time-remaining {
            color: #4a90e2;
            font-weight: 600;
        }

        .label {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .value {
            color: #fff;
            font-weight: 600;
            font-size: 1rem;
        }

        .green { color: #10b981; }
        .red { color: #dc2626; }
        .blue { color: #4a90e2; }

        .mission-item {
            background: #000;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #1a1a1a;
            margin-bottom: 8px;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            font-size: 1.3rem;
            gap: 20px;
        }

        .loading::after {
            content: '';
            width: 40px;
            height: 40px;
            border: 4px solid #333;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .divider {
            border-top: 1px solid #1a1a1a;
            padding-top: 8px;
            margin-top: 8px;
        }

        .info-note {
            background: #1a1a1a;
            border-left: 3px solid #4a90e2;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        .rewards-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 8px 0;
        }

        .reward-box {
            padding: 8px;
            border-radius: 6px;
            background: #1a1a1a;
            border: 1px solid #333;
        }

        .cycle-box {
            background: #000;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #1a1a1a;
            margin-bottom: 10px;
        }

        .cycle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .weapon-item {
            background: #1a1a1a;
            padding: 8px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            border: 1px solid #333;
        }

        .weapon-number {
            width: 24px;
            height: 24px;
            background: #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            margin-right: 10px;
            color: #fff;
        }

        .error {
            text-align: center;
            padding: 30px;
            color: #dc2626;
        }

        .cache-indicator {
            font-size: 0.75rem;
            color: #666;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="title">
                <span>‚ö° WARFRAME TRACKER</span>
                <div class="status-indicator" id="statusDot"></div>
            </div>
            <div class="search-bar">
                <input 
                    type="text" 
                    class="search-input" 
                    id="searchInput" 
                    placeholder="Search activities, missions, rewards..."
                />
                <button class="refresh-btn" onclick="fetchData()">üîÑ Refresh</button>
                <button class="clear-btn" onclick="clearSearch()">‚úï Clear</button>
            </div>
            <div class="cache-indicator" id="cacheInfo"></div>
        </div>
    </div>
    
    <div id="app"></div>

    <script>
        const API_BASE = 'https://api.warframestat.us/pc';

        const INCARNON_ROTATION = [
            { week: 1, weapons: ['Braton', 'Lato', 'Skana', 'Paris', 'Kunai'] },
            { week: 2, weapons: ['Boar', 'Gammacor', 'Angstrum', 'Gorgon', 'Anku'] },
            { week: 3, weapons: ['Bo', 'Latron', 'Furis', 'Furax', 'Strun'] },
            { week: 4, weapons: ['Lex', 'Magistar', 'Boltor', 'Bronco', 'Ceramic Dagger'] },
            { week: 5, weapons: ['Torid', 'Dual Toxocyst', 'Dual Ichor', 'Miter'] },
            { week: 6, weapons: ['Ack & Brunt', 'Soma', 'Vasto', 'Nami Solo', 'Burston'] },
            { week: 7, weapons: ['Zylok', 'Sibear', 'Dread', 'Despair', 'Hate'] },
            { week: 8, weapons: ['Dera', 'Sybaris', 'Cestra', 'Sicarus', 'Okina'] },
        ];

        let selectedTier = 'all';
        let gameData = null;
        let searchQuery = '';

        document.getElementById('searchInput')?.addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase().trim();
            render();
        });

        function clearSearch() {
            searchQuery = '';
            document.getElementById('searchInput').value = '';
            render();
        }

        function formatTimeRemaining(expiry) {
            const now = new Date();
            const end = new Date(expiry);
            const diff = end - now;

            if (diff <= 0) return 'Expired';

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            
            if (days > 0) return `${days}d ${hours}h ${minutes}m`;
            if (hours > 0) return `${hours}h ${minutes}m`;
            return `${minutes}m`;
        }

        function getCurrentIncarnonWeek() {
            const startDate = new Date('2024-10-07T00:00:00Z');
            const now = new Date();
            const diffTime = now - startDate;
            const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
            const currentWeek = (diffWeeks % 8) + 1;
            return INCARNON_ROTATION.find(r => r.week === currentWeek);
        }

        function matchesSearch(text) {
            if (!searchQuery) return true;
            return text.toLowerCase().includes(searchQuery);
        }

        async function fetchData() {
            document.getElementById('app').innerHTML = '<div class="loading">Loading Warframe Data...</div>';

            try {
                const responses = await Promise.all([
                    fetch(`${API_BASE}/fissures`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/invasions`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/sortie`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/voidTrader`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/archonHunt`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/cetusCycle`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/vallisCycle`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/cambionCycle`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/earthCycle`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/alerts`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/events`).then(r => r.json()).catch(() => []),
                    fetch(`${API_BASE}/nightwave`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/arbitration`).then(r => r.json()).catch(() => null),
                    fetch(`${API_BASE}/steelPath`).then(r => r.json()).catch(() => null)
                ]);

                gameData = {
                    fissures: responses[0],
                    invasions: responses[1],
                    sortie: responses[2],
                    voidTrader: responses[3],
                    archonHunt: responses[4],
                    cetusCycle: responses[5],
                    vallisCycle: responses[6],
                    cambionCycle: responses[7],
                    earthCycle: responses[8],
                    alerts: responses[9],
                    events: responses[10],
                    nightwave: responses[11],
                    arbitration: responses[12],
                    steelPath: responses[13]
                };

                const cacheInfo = document.getElementById('cacheInfo');
                if (cacheInfo) {
                    cacheInfo.textContent = `‚úì Live data ‚Ä¢ Last updated: ${new Date().toLocaleTimeString()}`;
                }

                render();
            } catch (err) {
                document.getElementById('app').innerHTML = `
                    <div class="error">
                        <div>‚ö†Ô∏è Error Loading Data</div>
                        <div style="font-size: 1rem; margin-top: 20px;">${err.message}</div>
                        <button class="refresh-btn" onclick="fetchData()" style="margin-top: 20px;">üîÑ Try Again</button>
                    </div>
                `;
            }
        }

        function render() {
            if (!gameData) return;

            let content = '';

            // Open World Cycles
            if (matchesSearch('cycle cetus vallis cambion earth')) {
                content += renderCycles();
            }

            // Void Fissures
            const filteredFissures = gameData.fissures.filter(f => 
                (selectedTier === 'all' || f.tier === selectedTier) &&
                matchesSearch(`${f.node} ${f.missionType} ${f.tier} ${f.enemy}`)
            );
            if (filteredFissures.length > 0) {
                content += renderVoidFissures(filteredFissures);
            }

            // Sortie
            if (gameData.sortie && matchesSearch(`sortie ${gameData.sortie.boss || ''} ${gameData.sortie.faction || ''}`)) {
                content += renderSortie();
            }

            // Archon Hunt
            if (gameData.archonHunt && matchesSearch(`archon ${gameData.archonHunt.boss || ''}`)) {
                content += renderArchonHunt();
            }

            // Arbitration
            if (gameData.arbitration && matchesSearch('arbitration')) {
                content += renderArbitration();
            }

            // Steel Path
            if (gameData.steelPath && matchesSearch('steel path')) {
                content += renderSteelPath();
            }

            // Invasions
            const activeInvasions = gameData.invasions.filter(inv => !inv.completed);
            if (activeInvasions.length > 0 && activeInvasions.some(inv => matchesSearch(`invasion ${inv.node}`))) {
                content += renderInvasions(activeInvasions);
            }

            // Incarnon
            if (matchesSearch('incarnon circuit')) {
                content += renderIncarnonRotation(getCurrentIncarnonWeek());
            }

            // Void Trader
            if (gameData.voidTrader && matchesSearch('baro void trader')) {
                content += renderVoidTrader();
            }

            // Alerts
            if (gameData.alerts.length > 0 && matchesSearch('alert')) {
                content += renderAlerts();
            }

            // Events
            if (gameData.events.length > 0) {
                const matchingEvents = gameData.events.filter(e => 
                    matchesSearch(`event ${e.description || ''}`)
                );
                if (matchingEvents.length > 0) {
                    content += renderEvents(matchingEvents);
                }
            }

            // Nightwave
            if (gameData.nightwave && matchesSearch('nightwave')) {
                content += renderNightwave();
            }

            if (!content) {
                content = `<div class="error">No activities found${searchQuery ? ` for "${searchQuery}"` : ''}</div>`;
            }

            document.getElementById('app').innerHTML = `<div class="container"><div class="grid">${content}</div></div>`;
            attachEventListeners();
        }

        function renderCycles() {
            const { cetusCycle, vallisCycle, cambionCycle, earthCycle } = gameData;
            if (!cetusCycle && !vallisCycle && !cambionCycle && !earthCycle) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üåç</div>
                        <div class="card-title">Open World Cycles</div>
                    </div>
                    ${cetusCycle ? `
                        <div class="cycle-box">
                            <div class="cycle-header">
                                <span style="font-weight: 600;">Plains of Eidolon</span>
                                <span class="badge" style="background: ${cetusCycle.isDay ? '#f59e0b' : '#3b82f6'};">
                                    ${cetusCycle.isDay ? '‚òÄÔ∏è Day' : 'üåô Night'}
                                </span>
                            </div>
                            <div class="label">
                                Changes in: <span class="time-remaining" data-expiry="${cetusCycle.expiry}">${formatTimeRemaining(cetusCycle.expiry)}</span>
                            </div>
                        </div>
                    ` : ''}
                    ${earthCycle ? `
                        <div class="cycle-box">
                            <div class="cycle-header">
                                <span style="font-weight: 600;">Earth</span>
                                <span class="badge" style="background: ${earthCycle.isDay ? '#f59e0b' : '#3b82f6'};">
                                    ${earthCycle.isDay ? '‚òÄÔ∏è Day' : 'üåô Night'}
                                </span>
                            </div>
                            <div class="label">
                                Changes in: <span class="time-remaining" data-expiry="${earthCycle.expiry}">${formatTimeRemaining(earthCycle.expiry)}</span>
                            </div>
                        </div>
                    ` : ''}
                    ${vallisCycle ? `
                        <div class="cycle-box">
                            <div class="cycle-header">
                                <span style="font-weight: 600;">Orb Vallis</span>
                                <span class="badge" style="background: ${vallisCycle.isWarm ? '#ea580c' : '#06b6d4'};">
                                    ${vallisCycle.isWarm ? 'üî• Warm' : '‚ùÑÔ∏è Cold'}
                                </span>
                            </div>
                            <div class="label">
                                Changes in: <span class="time-remaining" data-expiry="${vallisCycle.expiry}">${formatTimeRemaining(vallisCycle.expiry)}</span>
                            </div>
                        </div>
                    ` : ''}
                    ${cambionCycle ? `
                        <div class="cycle-box" style="margin-bottom: 0;">
                            <div class="cycle-header">
                                <span style="font-weight: 600;">Cambion Drift</span>
                                <span class="badge" style="background: #9333ea;">
                                    ${(cambionCycle.state || cambionCycle.active || 'unknown').toUpperCase()}
                                </span>
                            </div>
                            <div class="label">
                                Changes in: <span class="time-remaining" data-expiry="${cambionCycle.expiry}">${formatTimeRemaining(cambionCycle.expiry)}</span>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderVoidFissures(fissures) {
            const normalFissures = fissures.filter(f => !f.isHard);
            const steelFissures = fissures.filter(f => f.isHard);
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚ö°</div>
                        <div class="card-title">Void Fissures</div>
                    </div>
                    <div class="tier-filters">
                        ${['all', 'Lith', 'Meso', 'Neo', 'Axi', 'Requiem', 'Omnia'].map(tier => `
                            <button class="tier-btn ${selectedTier === tier ? 'active' : ''}" data-tier="${tier}">
                                ${tier}
                            </button>
                        `).join('')}
                    </div>
                    <div class="scrollable">
                        ${normalFissures.length > 0 ? '<div style="color: #fff; font-weight: 600; margin-bottom: 10px; font-size: 0.9rem;">Normal Fissures</div>' : ''}
                        ${normalFissures.map(f => `
                            <div class="content-box">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; flex-wrap: wrap; gap: 5px;">
                                    <div>
                                        <span class="badge ${f.tier.toLowerCase()}">${f.tier}</span>
                                        ${f.isStorm ? '<span class="badge storm">Storm</span>' : ''}
                                    </div>
                                    <span class="time-remaining" data-expiry="${f.expiry}">${formatTimeRemaining(f.expiry)}</span>
                                </div>
                                <div class="value" style="font-size: 0.9rem;">${f.node}</div>
                                <div class="label" style="font-size: 0.8rem;">${f.missionType} ‚Ä¢ ${f.enemy}</div>
                            </div>
                        `).join('')}
                        ${steelFissures.length > 0 ? '<div style="color: #dc2626; font-weight: 600; margin: 12px 0 8px 0; font-size: 0.9rem;">Steel Path Fissures</div>' : ''}
                        ${steelFissures.map(f => `
                            <div class="content-box" style="border-color: #dc2626;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; flex-wrap: wrap; gap: 5px;">
                                    <div>
                                        <span class="badge ${f.tier.toLowerCase()}">${f.tier}</span>
                                        <span class="badge" style="background: #dc2626;">Steel</span>
                                        ${f.isStorm ? '<span class="badge storm">Storm</span>' : ''}
                                    </div>
                                    <span class="time-remaining" data-expiry="${f.expiry}">${formatTimeRemaining(f.expiry)}</span>
                                </div>
                                <div class="value" style="font-size: 0.9rem;">${f.node}</div>
                                <div class="label" style="font-size: 0.8rem;">${f.missionType} ‚Ä¢ ${f.enemy}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderSortie() {
            const s = gameData.sortie;
            if (!s) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üéØ</div>
                        <div class="card-title">Sortie</div>
                    </div>
                    <div class="content-box">
                        <div style="margin-bottom: 12px;">
                            <div class="label">Boss</div>
                            <div class="value">${s.boss || 'Unknown'}</div>
                            <div class="label" style="margin-top: 4px;">${s.faction || 'Unknown Faction'}</div>
                        </div>
                        ${s.variants && s.variants.length > 0 ? `
                            <div style="margin-bottom: 10px;">
                                ${s.variants.map((v, i) => `
                                    <div class="mission-item">
                                        <div style="font-weight: 600; margin-bottom: 4px; font-size: 0.9rem;">Mission ${i + 1}: ${v.missionType || 'Unknown'}</div>
                                        <div class="label" style="font-size: 0.75rem;">${v.node || 'Unknown Location'}</div>
                                        <div class="blue" style="font-size: 0.8rem; margin-top: 4px;">‚ö†Ô∏è ${v.modifier || v.modifierDescription || 'No Modifier'}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        <div class="divider">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="label">Resets In</span>
                                <span class="time-remaining" data-expiry="${s.expiry}">${formatTimeRemaining(s.expiry)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderArchonHunt() {
            const ah = gameData.archonHunt;
            if (!ah) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üëπ</div>
                        <div class="card-title">Archon Hunt</div>
                    </div>
                    <div class="content-box">
                        <div style="margin-bottom: 12px;">
                            <div class="label">Target</div>
                            <div class="value">${ah.boss || 'Unknown Archon'}</div>
                            <div class="label" style="margin-top: 4px;">${ah.faction || 'Unknown Faction'}</div>
                        </div>
                        ${ah.missions && ah.missions.length > 0 ? `
                            <div style="margin-bottom: 10px;">
                                ${ah.missions.map((m, i) => `
                                    <div class="mission-item">
                                        <div style="font-weight: 600; font-size: 0.9rem;">Mission ${i + 1}: ${m.type || 'Unknown'}</div>
                                        <div class="label" style="font-size: 0.75rem;">${m.node || 'Unknown Location'}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        <div class="divider">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="label">Resets In</span>
                                <span class="time-remaining" data-expiry="${ah.expiry}">${formatTimeRemaining(ah.expiry)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderArbitration() {
            const arb = gameData.arbitration;
            if (!arb) return '';

            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üõ°Ô∏è</div>
                        <div class="card-title">Arbitration</div>
                    </div>
                    <div class="content-box">
                        <div style="margin-bottom: 12px;">
                            <div class="label">Mission</div>
                            <div class="value">${arb.node || 'Loading...'}</div>
                            <div class="label" style="margin-top: 4px;">${arb.type || 'Unknown Type'}</div>
                        </div>
                        <div style="margin-bottom: 12px;">
                            <div class="label">Enemy</div>
                            <div class="value">${arb.enemy || 'Unknown'}</div>
                        </div>
                        ${arb.archwing !== undefined ? `
                            <div class="label" style="margin-bottom: 12px;">
                                ${arb.archwing ? '‚úì Archwing Required' : '‚úó No Archwing'}
                            </div>
                        ` : ''}
                        <div class="divider">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="label">Rotates In</span>
                                <span class="time-remaining" data-expiry="${arb.expiry}">${formatTimeRemaining(arb.expiry)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSteelPath() {
            const sp = gameData.steelPath;
            if (!sp) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚öîÔ∏è</div>
                        <div class="card-title">Steel Path</div>
                    </div>
                    <div class="content-box">
                        ${sp.currentReward ? `
                            <div style="margin-bottom: 12px;">
                                <div class="label">Current Reward</div>
                                <div class="value">${sp.currentReward.name || 'Unknown'}</div>
                            </div>
                        ` : ''}
                        ${sp.remaining ? `
                            <div class="label">Remaining: ${sp.remaining}</div>
                        ` : ''}
                        <div class="divider">
                            <div style="display: flex; justify-content: space-between;">
                                <span class="label">Rotates In</span>
                                <span class="time-remaining" data-expiry="${sp.expiry}">${formatTimeRemaining(sp.expiry)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderInvasions(invasions) {
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">‚öîÔ∏è</div>
                        <div class="card-title">Invasions</div>
                    </div>
                    <div class="scrollable">
                        ${invasions.filter(inv => matchesSearch(`invasion ${inv.node}`)).map(inv => `
                            <div class="content-box">
                                <div class="value" style="font-size: 0.9rem; margin-bottom: 6px;">${inv.node}</div>
                                <div class="label" style="margin-bottom: 8px; font-size: 0.8rem;">${inv.attackingFaction} vs ${inv.defendingFaction}</div>
                                <div class="rewards-grid">
                                    <div class="reward-box">
                                        <div class="label" style="font-size: 0.75rem;">Attackers</div>
                                        <div style="font-weight: 600; font-size: 0.8rem;">${inv.attackerReward?.itemString || inv.attackerReward?.credits + ' Credits' || 'Unknown'}</div>
                                    </div>
                                    <div class="reward-box">
                                        <div class="label" style="font-size: 0.75rem;">Defenders</div>
                                        <div style="font-weight: 600; font-size: 0.8rem;">${inv.defenderReward?.itemString || inv.defenderReward?.credits + ' Credits' || 'Unknown'}</div>
                                    </div>
                                </div>
                                <div class="label" style="text-align: center; margin-top: 6px; font-size: 0.8rem;">${(inv.completion || 0).toFixed(1)}% Complete</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderIncarnonRotation(week) {
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üìà</div>
                        <div class="card-title">Incarnon Rotation</div>
                    </div>
                    <div class="content-box">
                        <div style="margin-bottom: 14px;">
                            <div class="value" style="font-size: 1.1rem;">Week ${week.week} of 8</div>
                            <div class="label" style="margin-top: 4px;">Steel Path Circuit Rewards</div>
                        </div>
                        ${week.weapons.map((w, i) => `
                            <div class="weapon-item">
                                <div class="weapon-number">${i + 1}</div>
                                <span style="font-weight: 600; font-size: 0.9rem;">${w}</span>
                            </div>
                        `).join('')}
                        <div class="info-note">
                            üí° Pick 2 Incarnon Adapters at Circuit Rank 5 and 10
                        </div>
                    </div>
                </div>
            `;
        }

        function renderVoidTrader() {
            const vt = gameData.voidTrader;
            if (!vt) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üé≠</div>
                        <div class="card-title">Baro Ki'Teer</div>
                    </div>
                    <div class="content-box">
                        ${vt.active ? `
                            <div style="margin-bottom: 12px;">
                                <div class="value green" style="margin-bottom: 8px;">‚úì Active Now</div>
                                <div class="value" style="font-size: 0.95rem;">üìç ${vt.location || 'Unknown Location'}</div>
                            </div>
                            <div class="divider">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="label">Leaves In</span>
                                    <span class="time-remaining" data-expiry="${vt.expiry}">${formatTimeRemaining(vt.expiry)}</span>
                                </div>
                            </div>
                        ` : `
                            <div style="margin-bottom: 12px;">
                                <div class="value" style="color: #666; margin-bottom: 8px;">Away</div>
                                <div class="label">Not currently visiting</div>
                            </div>
                            <div class="divider">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="label">Arrives In</span>
                                    <span class="time-remaining" data-expiry="${vt.activation}">${formatTimeRemaining(vt.activation)}</span>
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAlerts() {
            const filtered = gameData.alerts.filter(a => matchesSearch(`alert ${a.mission?.node || ''}`));
            if (filtered.length === 0) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üö®</div>
                        <div class="card-title">Alerts</div>
                    </div>
                    <div class="scrollable">
                        ${filtered.map(alert => `
                            <div class="content-box">
                                <div class="value" style="font-size: 0.9rem; margin-bottom: 6px;">${alert.mission?.node || 'Unknown'}</div>
                                <div class="label" style="margin-bottom: 8px; font-size: 0.8rem;">${alert.mission?.type || 'Unknown'} ‚Ä¢ ${alert.mission?.faction || 'Unknown'}</div>
                                ${alert.mission?.reward ? `
                                    <div style="margin-bottom: 8px;">
                                        <div class="label" style="font-size: 0.75rem;">Rewards</div>
                                        <div style="font-weight: 600; font-size: 0.85rem;">
                                            ${alert.mission.reward.itemString || alert.mission.reward.credits + ' Credits' || 'Unknown'}
                                        </div>
                                    </div>
                                ` : ''}
                                <div class="divider">
                                    <div style="display: flex; justify-content: space-between;">
                                        <span class="label">Expires In</span>
                                        <span class="time-remaining" data-expiry="${alert.expiry}">${formatTimeRemaining(alert.expiry)}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderEvents(events) {
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üéâ</div>
                        <div class="card-title">Events</div>
                    </div>
                    <div class="scrollable">
                        ${events.map(event => `
                            <div class="content-box">
                                <div class="value" style="margin-bottom: 8px; font-size: 0.9rem;">${event.description || 'Event Active'}</div>
                                ${event.rewards && event.rewards.length > 0 ? `
                                    <div style="margin-bottom: 8px;">
                                        <div class="label" style="font-size: 0.75rem;">Rewards</div>
                                        ${event.rewards.map(r => `<div style="font-size: 0.8rem;">‚Ä¢ ${r.itemString || r}</div>`).join('')}
                                    </div>
                                ` : ''}
                                ${event.expiry ? `
                                    <div class="divider">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span class="label">Ends In</span>
                                            <span class="time-remaining" data-expiry="${event.expiry}">${formatTimeRemaining(event.expiry)}</span>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderNightwave() {
            const nw = gameData.nightwave;
            if (!nw) return '';
            
            return `
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">üåä</div>
                        <div class="card-title">Nightwave</div>
                    </div>
                    <div class="content-box">
                        ${nw.season ? `
                            <div style="margin-bottom: 12px;">
                                <div class="label">Season</div>
                                <div class="value">Season ${nw.season}</div>
                            </div>
                        ` : ''}
                        ${nw.tag ? `
                            <div style="margin-bottom: 12px;">
                                <div class="label">Current Phase</div>
                                <div class="value" style="font-size: 0.9rem;">${nw.tag}</div>
                            </div>
                        ` : ''}
                        ${nw.phase !== undefined ? `
                            <div class="label" style="margin-bottom: 12px;">Phase ${nw.phase}</div>
                        ` : ''}
                        ${nw.expiry ? `
                            <div class="divider">
                                <div style="display: flex; justify-content: space-between;">
                                    <span class="label">Ends In</span>
                                    <span class="time-remaining" data-expiry="${nw.expiry}">${formatTimeRemaining(nw.expiry)}</span>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function attachEventListeners() {
            document.querySelectorAll('.tier-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedTier = btn.dataset.tier;
                    render();
                });
            });
        }

        function startTimeUpdates() {
            setInterval(() => {
                document.querySelectorAll('[data-expiry]').forEach(el => {
                    el.textContent = formatTimeRemaining(el.dataset.expiry);
                });
            }, 30000);
        }

        // Initialize
        fetchData();
        setInterval(fetchData, 60000);
        startTimeUpdates();
    </script>
</body>
</html>
